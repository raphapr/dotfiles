# Variables             ----------------------------------------------------- {{{

set $mod Mod4
set $mod2 Mod4+Shift
set $BROWSER    firefox
set $TERM       kitty -1
set $FM         thunar
set $PRINT      flameshot gui

# }}}
# Startup apps          ----------------------------------------------------- {{{

exec --no-startup-id nm-applet
exec --no-startup-id volnoti
exec --no-startup-id udiskie
exec --no-startup-id dropbox start
exec --no-startup-id picom -b
exec --no-startup-id thunar --daemon
exec --no-startup-id autorandr --change && feh --bg-fill ~/.wallpaper.png
exec --no-startup-id /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec --no-startup-id telegram-desktop -startintray
exec --no-startup-id sleep 2 && flameshot
exec --no-startup-id /usr/lib/geoclue-2.0/demos/agent
exec --no-startup-id greenclip daemon
exec --no-startup-id bash -c '[ "$(hostname)" = "bmo" ] && setxkbmap us -variant alt-intl && xmodmap ~/.Xmodmap'
exec --no-startup-id bash -c '[ "$(hostname)" = "moochacho" ] && setxkbmap br -variant abnt2 && xmodmap ~/.Xmodmap && autorandr off && autorandr -c'
exec --no-startup-id ~/.bin/xidlehook-lock
exec_always --no-startup-id ~/.bin/set-keyboard-repeat
exec_always --no-startup-id xset -dpms
exec_always --no-startup-id xss-lock --transfer-sleep-lock -- i3lock --nofork --show-failed-attempts --ignore-empty-password -c 000000
exec_always --no-startup-id $HOME/.config/polybar/launch.sh

#}}}
# General options       ----------------------------------------------------- {{{

workspace_layout tabbed

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
font pango:NotoSansRegular 7

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# disable mouse warp to the center of the window
mouse_warping none

workspace 4 output DVI-D-0

# }}}
# i3 Shortcuts          ----------------------------------------------------- {{{

# %%hotkey: border toggle
bindsym $mod2+b border toggle

# %%hotkey: kill focused window
bindsym $mod+BackSpace kill

# %%hotkey: rofi window mode
bindsym $mod+Tab exec rofi -show window
# %%hotkey: show clipboard history
bindsym $mod+n exec --no-startup-id ~/.bin/rofi-clipboard
# %%hotkey: rofi-powermenu
bindsym $mod+0 exec --no-startup-id ~/.config/rofi/powermenu/powermenu.sh

# %%hotkey: 1password
bindsym $mod+y exec --no-startup-id 1password --quick-access

# %%hotkey: change focus left
bindsym $mod+h focus left
# %%hotkey: change focus down
bindsym $mod+j focus down
# %%hotkey: change focus up
bindsym $mod+k focus up
# %%hotkey: change focus right
bindsym $mod+l focus right

# %%hotkey: move focused window left
bindsym $mod2+h move left
# %%hotkey: move focused window down
bindsym $mod2+j move down
# %%hotkey: move focused window up
bindsym $mod2+k move up
# %%hotkey: move focused window right
bindsym $mod2+l move right

# %%hotkey: move focused window left (alternative)
bindsym $mod2+Left move left
# %%hotkey: move focused window down (alternative)
bindsym $mod2+Down move down
# %%hotkey: move focused window up (alternative)
bindsym $mod2+Up move up
# %%hotkey: move focused window right (alternative)
bindsym $mod2+Right move right

# %%hotkey: split in horizontal orientation
bindsym $mod+v split h

# %%hotkey: split in vertical orientation
bindsym $mod+b split v

# %%hotkey: enter fullscreen mode for the focused container
bindsym F12 fullscreen
bindsym $mod+F12 fullscreen

# %%hotkey: container layout - stacking
bindsym $mod+s layout stacking
# %%hotkey: container layout - tabbed
bindsym $mod+w layout tabbed
# %%hotkey: container layout - toggle split
bindsym $mod+e layout toggle split

# %%hotkey: floating toggle
bindsym $mod2+space floating toggle

# %%hotkey: center floating window
bindsym $mod+c move position center

# %%hotkey: change focus between tiling / floating windows
bindsym $mod+z focus mode_toggle

# %%hotkey: focus the parent container
bindsym $mod+a focus parent

# %%hotkey: app launcher
bindsym $mod+d exec --no-startup-id rofi -show drun

# %%hotkey: jump workspace prev
bindsym $mod+Left workspace prev
# %%hotkey: jump workspace next
bindsym $mod+Right workspace next

# %%hotkey: restart i3 (preserves your layout/session, can be used to upgrade i3)
bindsym $mod2+r restart

# %%hotkey: exit i3 (logs you out of your X session)
bindsym $mod2+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"

# %%hotkey: resize window
bindsym $mod+r mode "resize"

# resize window (you can also use the mouse for that)
mode "resize" {
        # These bindings trigger as soon as you enter the resize mode

        # Pressing left will shrink the window’s width.
        # Pressing right will grow the window’s width.
        # Pressing up will shrink the window’s height.
        # Pressing down will grow the window’s height.
        bindsym j resize shrink width 10 px or 10 ppt
        bindsym k resize grow height 10 px or 10 ppt
        bindsym l resize shrink height 10 px or 10 ppt
        bindsym ccedilla resize grow width 10 px or 10 ppt

        # same bindings, but for the arrow keys
        bindsym Left resize shrink width 10 px or 10 ppt
        bindsym Down resize grow height 10 px or 10 ppt
        bindsym Up resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # back to normal: Enter or Escape
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym $mod+r mode "default"
}

# switch to workspace
bindsym $mod+u workspace 1
bindsym $mod+i workspace 2
bindsym $mod+o workspace 3
bindsym $mod+p workspace 4
bindsym $mod+5 workspace 5
bindsym $mod+6 workspace 6
bindsym $mod+7 workspace 7
bindsym $mod+8 workspace 8
bindsym $mod+9 workspace 9

# move focused container to workspace
bindsym $mod2+u move container to workspace 1
bindsym $mod2+i move container to workspace 2
bindsym $mod2+o move container to workspace 3
bindsym $mod2+p move container to workspace 4
bindsym $mod2+5 move container to workspace 5
bindsym $mod2+6 move container to workspace 6
bindsym $mod2+7 move container to workspace 7
bindsym $mod2+8 move container to workspace 8
bindsym $mod2+9 move container to workspace 9
bindsym $mod2+0 move container to workspace 10

#}}}
# Custom Shortcuts      ----------------------------------------------------- {{{

# %%hotkey: google chrome incognito
bindsym $mod+slash exec --no-startup-id $BROWSER --private-window

# %%hotkey: start terminal
bindsym $mod+Return exec --no-startup-id $TERM

# %%hotkey: open tmux session main
bindsym $mod2+Return exec $TERM -e $HOME/.bin/tmux-session main

# %%hotkey: browser
bindsym $mod+q exec --no-startup-id $BROWSER

# %%hotkey: flameshot print screen
bindsym --release $mod+Print exec --no-startup-id unset SESSION_MANAGER && $PRINT

# %%hotkey: screensaver
bindsym $mod+t exec --no-startup-id ~/.bin/suspend-screensaver

# %%hotkey: keyboard layout
bindsym $mod+F9 exec --no-startup-id ~/.bin/klayout-toggle

# %%hotkey: lock screen
bindsym $mod+x exec --no-startup-id loginctl lock-session

# %%hotkey: move workspace to output left
bindsym $mod+shift+x move workspace to output left

# %%hotkey: move workspace to output up
bindsym $mod+bracketleft move workspace to output up

# %%hotkey: volume up
bindsym XF86AudioRaiseVolume exec --no-startup-id ~/.bin/volume up
# %%hotkey: volume down
bindsym XF86AudioLowerVolume exec --no-startup-id ~/.bin/volume down
# %%hotkey: volume mute
bindsym XF86AudioMute        exec --no-startup-id ~/.bin/volume mute

# media player controller
bindsym XF86AudioPlay exec playerctl play
bindsym XF86AudioPause exec playerctl pause
bindsym XF86AudioStop exec playerctl stop
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous

# brightness
bindsym XF86MonBrightnessUp exec --no-startup-id  "brightnessctl set 25%+"
bindsym XF86MonBrightnessDown exec --no-startup-id "brightnessctl set 25%-"

# %%hotkey: mute spotify player
bindsym $mod+comma exec --no-startup-id ~/.bin/playerctl-mute-toggle

# %%hotkey: dunst close-all
bindsym Ctrl+space exec --no-startup-id dunstctl close-all

#}}}
# Borders               ----------------------------------------------------- {{{

default_floating_border normal 2
default_border pixel 2
hide_edge_borders none

#}}}
# Theme colors          ----------------------------------------------------- {{{

client.focused          #89b4fa #89b4fa #1e1e2e #f5e0dc
client.focused_inactive #45475a #45475a #cdd6f4 #45475a
client.unfocused        #313244 #313244 #6c7086 #313244
client.urgent           #f38ba8 #f38ba8 #1e1e2e #f38ba8

#}}}
# Window rules          ----------------------------------------------------- {{{

# floating windows
for_window [class="Steam" instance="Steam" title="Friends"] floating enable
for_window [title="Lock Screen — 1Password"] floating enable resize set 800 500
for_window [window_role="About"] floating enable
for_window [window_role="Organizer"] floating enable
for_window [window_role="Preferences"] floating enable
for_window [window_role="bubble"] floating enable
for_window [window_role="page-info"] floating enable
for_window [window_role="pop-up"] floating enable
for_window [window_role="task_dialog"] floating enable
for_window [window_role="toolbox"] floating enable
for_window [window_role="webconsole"] floating enable
for_window [window_type="dialog"] floating enable
for_window [window_type="menu"] floating enable

# Browser window groups
for_window [title="^\.Main.*"] move to workspace 1
for_window [title="^\.Support.*"] move to workspace 1
for_window [title="^\.Personal.*"] move to workspace 3
for_window [title="^\.Screen2.*"] move to workspace 4
for_window [title="^\.Study.*"] move to workspace 5
for_window [title="^\.Writing.*"] move to workspace 6

# Apps
for_window [class="Spotify"] move container to workspace 2
for_window [class="TelegramDesktop"] move container to workspace 2
for_window [title="WhatsApp Web"] move to workspace 2
for_window [title="WhatsDesk"] move to workspace 2

#}}}
# Scratchpads           ----------------------------------------------------- {{{

set $journal kitty --instance-group scratchpad-journal --class=scratchpad-journal -e $HOME/.bin/tmux-session scratchpad-journal
set $launcher kitty --instance-group scratchpad-launcher --class=scratchpad-launcher -e fish -c 'otter-launcher'

# %%hotkey: launch journal scratchpad in case accidentally closed or whatever
bindsym $mod+F11 exec $journal
exec $journal
for_window [class="scratchpad-journal"] move to scratchpad, resize set width 1000 height 600
# %%hotkey: launch scratchpad-journal
bindsym F11 [class="scratchpad-journal"] scratchpad show

# %%hotkey: launch otter-launcher scratchpad in case accidentally closed or whatever
bindsym $mod2+f exec $launcher
exec $launcher
for_window [class="scratchpad-launcher"] move to scratchpad, resize set width 420 height 330, border none
# %%hotkey: launch otter-launcher
bindsym $mod+f [class="scratchpad-launcher"] scratchpad show
bindsym $mod+space [class="scratchpad-launcher"] scratchpad show

#}}}
